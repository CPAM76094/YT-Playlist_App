<!doctype html>
<html lang="fr" class="h-100">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- IMPORTANT : Pour éviter le référencement de la page -->
        <meta name="robots" content="noindex">
        <title>Youtube Api Playlist AM CPAM76 </title>
        <!-- Chargement CSS  -->
        <link href="css/style.css" rel="stylesheet">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
     </head>

<div class="loading-overlay">
  <span class="fas fa-spinner fa-3x fa-spin"></span>
</div>
<div class="video-container">
  <div class="container">
    <div class="ypt_wrapper">
      <div class="video embed-container">
        <div id="ytpl-playerAM76" data-pl="PLSVAZsq7pCw8GcUgZin3wq2eImWWZFdME">
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  let overlay = document.getElementsByClassName('loading-overlay')[0];
//overlay.classList.toggle('is-active');


var tag = document.createElement('script');
tag.src = "https://www.youtube.com/player_api";
var firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

var players_list = ["ytpl-playerAM76"];

function getPlaylistData(playerName) {
    var apiKey = 'AIzaSyDI4rWo_wVAxRZEIgF6_8sRZDj8OCOZZ38';
    var url = 'https://www.googleapis.com/youtube/v3/playlistItems?part=snippet';
    var data = {
        'playlistId': $('#' + playerName).data('pl'),
        'key': apiKey
    };
    

}


// generate playlist items once main player has loaded
function onPlayerReady(event) {
      //setTimeout(overlay.classList.toggle('is-active'), 40000); 
      getPlaylistData(event.target.name);     
}


function onYouTubeIframeAPIReady() {
  
    for (item in players_list) {
        players_list[item] = new YT.Player(players_list[item], {
            playerVars: {
                listType: 'playlist',
                list: $('#' + players_list[item]).data('pl'),
                autoplay: 1,
                playsinline: 1, 
                rel: 0, 
                loop: 1, 
                autopause: 0, 
                modestbranding: 0, 
                enablejsapi: 1, 
                showinfo: 1,
            },
            events: {
                'onReady': onPlayerReady,
                'onStateChange': onPlayerStateChange
            }
        });
    }
}

function onPlayerStateChange(event) {
    var currentIndex = event.target.getPlaylistIndex();
    if(currentIndex) { console.log("Dernier clip :"+currentIndex+"/"+event.target.getPlaylist().length);}
    //console.log(currentIndex);
  }


</script>
